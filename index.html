<!doctype html>
<html lang="nl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>Tafeloverzicht</title>

<style>
:root{
  --bg:#f6f7f9;
  --card:#ffffff;
  --border:#e5e7eb;
  --text:#111827;
  --nieuw:#ef4444;
  --drank:#f59e0b;
  --run:#10b981;
  --koffie:#7c3aed;
  --rekening:#0ea5e9;
  --gap:8px;
  --tile:80px;
}

*{box-sizing:border-box}
html,body{height:100%;margin:0}

body{
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  background:var(--bg);
  display:flex;
  flex-direction:column;
}

/* HEADER */
header{
  background:var(--card);
  border-bottom:1px solid var(--border);
  padding:10px 14px;
  display:flex;
  align-items:center;
  gap:8px;
}
header h1{
  flex:1;
  font-size:18px;
  margin:0;
  font-weight:800;
}

/* TOOLBAR */
.toolbar{
  display:flex;
  gap:8px;
  flex-wrap:wrap;
}
button{
  border:1px solid var(--border);
  background:#fff;
  padding:8px 12px;
  border-radius:10px;
  font-weight:700;
  cursor:pointer;
}
button.help{border:2px solid var(--nieuw); color:var(--nieuw)}
button.text{border:2px solid #111}

/* MAIN */
main{
  flex:1;
  display:flex;
  flex-direction:column;
  gap:10px;
  padding:10px;
  overflow:hidden;
}

/* GROUPS */
.groups{
  flex:1;
  display:flex;
  flex-direction:column;
  gap:12px;
  overflow:hidden;
}
.group{
  flex:1;
  display:flex;
  flex-direction:column;
  gap:6px;
}
.group-label{
  background:#eef2f7;
  border:1px solid var(--border);
  padding:6px 10px;
  border-radius:10px;
  font-weight:900;
}
.group-grid{
  display:grid;
  gap:var(--gap);
  grid-template-columns:repeat(var(--cols),var(--tile));
  justify-content:center;
}

/* TABLE */
.table{
  width:var(--tile);
  height:var(--tile);
  background:var(--card);
  border:1px solid var(--border);
  border-radius:12px;
  display:grid;
  grid-template-rows:auto 1fr auto;
  place-items:center;
  position:relative;
  font-weight:800;
}
.table[data-status]{color:#fff;border:none}
.table.nieuw{background:var(--nieuw)}
.table.drank{background:var(--drank)}
.table.run{background:var(--run)}
.table.koffie{background:var(--koffie)}
.table.rekening{background:var(--rekening)}

.num{font-size:calc(var(--tile)*0.22)}
.num.flag{color:var(--nieuw)}
.table[data-status] .num{color:#fff}

.note{
  font-size:calc(var(--tile)*0.13);
  text-align:center;
  padding:0 4px;
}
.timer{
  position:absolute;
  bottom:6px;
  font-size:calc(var(--tile)*0.13);
}

/* OVERLAYS */
.overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:9999;
}
.overlay.show{display:flex}

.modal{
  background:#fff;
  border-radius:14px;
  width:90%;
  max-width:420px;
  padding:14px;
}
.modal h2{
  margin:0 0 10px;
  font-size:18px;
}
.modal-grid{
  display:grid;
  gap:10px;
}
.modal-grid button{width:100%}

/* ALERT SCREEN */
.alert-screen{
  position:fixed;
  inset:0;
  background:#fff;
  display:none;
  align-items:center;
  justify-content:center;
  z-index:10000;
}
.alert-screen.show{display:flex}
.alert-only{
  font-size:clamp(40px,10vw,96px);
  font-weight:1000;
  text-align:center;
  padding:20px;
}

/* INPUT */
input,textarea{
  width:100%;
  padding:10px;
  font-size:16px;
}
</style>
</head>

<body>

<header>
  <h1>Tafeloverzicht</h1>
  <div class="toolbar">
    <button id="resetAll">Reset</button>
    <button class="help" id="helpBtn">HELP</button>
    <button class="text" id="textBtn">TEXT</button>
  </div>
</header>

<main>
  <div class="groups" id="groups"></div>
</main>

<!-- STATUS MODAL -->
<div class="overlay" id="statusOverlay">
  <div class="modal">
    <h2>Status</h2>
    <div class="modal-grid">
      <button data-status="nieuw">Nieuw</button>
      <button data-status="drank">Drank</button>
      <button data-status="run">Run</button>
      <button data-status="koffie">Koffie</button>
      <button data-status="rekening">Rekening</button>
      <button data-reset>Reset nummer</button>
      <button data-close>Sluiten</button>
    </div>
  </div>
</div>

<!-- HELP -->
<div class="overlay" id="helpOverlay">
  <div class="modal">
    <h2>HELP</h2>
    <div class="modal-grid">
      <button data-msg="Bar Beneden">Bar Beneden</button>
      <button data-msg="Bar Boven">Bar Boven</button>
      <button data-msg="Run">Run</button>
      <button data-close>Sluiten</button>
    </div>
  </div>
</div>

<!-- TEXT -->
<div class="overlay" id="textOverlay">
  <div class="modal">
    <h2>TEXT</h2>
    <div class="modal-grid">
      <button data-msg="Boven uithalen">Boven uithalen</button>
      <button data-msg="IJs brengen">IJs brengen</button>
      <button id="customText">Eigen invoer</button>
      <button data-close>Sluiten</button>
    </div>
  </div>
</div>

<!-- CUSTOM TEXT -->
<div class="overlay" id="customOverlay">
  <div class="modal">
    <h2>Eigen bericht</h2>
    <input id="customInput" placeholder="Typ berichtâ€¦">
    <div class="modal-grid">
      <button id="sendCustom">Versturen</button>
      <button data-close>Annuleren</button>
    </div>
  </div>
</div>

<!-- ALERT -->
<div class="alert-screen" id="alertScreen">
  <div class="alert-only" id="alertText"></div>
</div>

<!-- SUPABASE -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
const supabase = supabase.createClient(
  "https://xiwdbvxnjcrdwjhmpjnf.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inhpd2RidnhuamNyZHdqaG1wam5mIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ2NjE1NzAsImV4cCI6MjA3MDIzNzU3MH0.d14QNY5Pof9j3zmlbs-5gBTs25s6xo_XYhyVbWE2P1k"
);

const groupsEl=document.getElementById("groups");
const alertScreen=document.getElementById("alertScreen");
const alertText=document.getElementById("alertText");

const GROUPS=[
  {name:"Beneden",zone:"bt",from:1,to:13},
  {name:"Boven",zone:"boven",from:20,to:58}
];

function showAlert(msg){
  alertText.textContent=msg;
  alertScreen.classList.add("show");
  const close=()=>alertScreen.classList.remove("show");
  alertScreen.onclick=close;
  setTimeout(close,6000);
}

/* Realtime broadcast */
supabase.channel("help_events")
.on("postgres_changes",{event:"INSERT",schema:"public",table:"help_events"},p=>{
  if(p.new?.kind) showAlert(p.new.kind);
}).subscribe();

/* HELP & TEXT */
document.querySelectorAll("[data-msg]").forEach(b=>{
  b.onclick=async()=>{
    const msg=b.dataset.msg;
    await supabase.from("help_events").insert({kind:msg});
    showAlert(msg);
    closeAll();
  }
});

/* Custom */
document.getElementById("sendCustom").onclick=async()=>{
  const v=document.getElementById("customInput").value.trim();
  if(!v) return;
  await supabase.from("help_events").insert({kind:v});
  showAlert(v);
  closeAll();
};

/* Overlay controls */
function closeAll(){document.querySelectorAll(".overlay").forEach(o=>o.classList.remove("show"))}
document.querySelectorAll("[data-close]").forEach(b=>b.onclick=closeAll);
document.getElementById("helpBtn").onclick=()=>document.getElementById("helpOverlay").classList.add("show");
document.getElementById("textBtn").onclick=()=>document.getElementById("textOverlay").classList.add("show");
document.getElementById("customText").onclick=()=>{
  closeAll();
  document.getElementById("customOverlay").classList.add("show");
};
</script>

</body>
</html>
