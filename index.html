<!doctype html>
<html lang="nl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Tafeloverzicht</title>

<style>
:root{
  --bg:#f6f7f9;
  --card:#ffffff;
  --text:#111827;
  --border:#e5e7eb;

  --nieuw:#ef4444;
  --drank:#f59e0b;
  --run:#10b981;
  --koffie:#7c3aed;
  --rekening:#0ea5e9;

  --gap:8px;
  --tile:72px;
}

*{box-sizing:border-box}
html,body{height:100%}

body{
  margin:0;
  background:var(--bg);
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  display:flex;
  flex-direction:column;
}

/* HEADER */
header{
  background:var(--card);
  border-bottom:1px solid var(--border);
  padding:10px 14px;
  display:flex;
  align-items:center;
}
header h1{
  margin:0;
  font-size:18px;
  font-weight:900;
  flex:1;
}

/* MAIN */
main{
  flex:1;
  display:flex;
  flex-direction:column;
  gap:10px;
  padding:10px 14px;
  min-height:0;
}

/* TOOLBAR */
.toolbar{
  display:flex;
  gap:8px;
  flex-wrap:wrap;
}
.btn{
  border:1px solid var(--border);
  background:#fff;
  padding:6px 12px;
  border-radius:10px;
  font-weight:800;
  cursor:pointer;
}
.help-btn{border:2px solid var(--nieuw); color:var(--nieuw)}
.text-btn{border:2px solid #111; font-weight:900}

/* GROUPS */
.groups{
  flex:1;
  display:flex;
  flex-direction:column;
  gap:12px;
  overflow:hidden;
}
.group{
  flex:1;
  display:flex;
  flex-direction:column;
  gap:6px;
}
.group-label{
  background:#eef2f7;
  border:1px solid var(--border);
  padding:6px 10px;
  border-radius:10px;
  font-weight:900;
}

/* GRID */
.group-grid{
  display:grid;
  grid-template-columns:repeat(var(--cols), var(--tile));
  grid-auto-rows:var(--tile);
  gap:var(--gap);
  justify-content:center;
  flex:1;
}

/* TABLE */
.table{
  width:var(--tile);
  height:var(--tile);
  background:var(--card);
  border:1px solid var(--border);
  border-radius:12px;
  display:grid;
  grid-template-rows:auto 1fr auto;
  align-items:center;
  justify-items:center;
  position:relative;
  cursor:pointer;
  font-weight:900;
}
.num{
  font-size:calc(var(--tile)*0.22);
}
.num.flagged{color:var(--nieuw)}
.note{
  font-size:calc(var(--tile)*0.14);
  text-align:center;
  padding:0 4px;
  line-height:1.1;
}
.timer{
  position:absolute;
  bottom:4px;
  font-size:calc(var(--tile)*0.14);
}

/* STATUS COLORS */
.table[data-status]{color:#fff; border:none}
.table[data-status] .num{color:#fff}
.table.status-nieuw{background:var(--nieuw)}
.table.status-drank{background:var(--drank)}
.table.status-run{background:var(--run)}
.table.status-koffie{background:var(--koffie)}
.table.status-rekening{background:var(--rekening)}

/* MODALS */
.overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:9999;
}
.overlay.open{display:flex}
.modal{
  background:#fff;
  border-radius:14px;
  width:90%;
  max-width:420px;
  border:1px solid var(--border);
}
.modal-header{
  padding:14px;
  font-weight:900;
  border-bottom:1px solid var(--border);
}
.modal-grid{
  padding:14px;
  display:grid;
  gap:10px;
}
.choice{
  padding:12px;
  border-radius:10px;
  border:1px solid var(--border);
  font-weight:800;
  cursor:pointer;
}
.choice.reset{border-color:#999}

/* FULLSCREEN MESSAGE */
.alert-screen{
  position:fixed;
  inset:0;
  background:#fff;
  display:none;
  align-items:center;
  justify-content:center;
  z-index:10000;
}
.alert-screen.show{display:flex}
.alert-only{
  font-size:clamp(36px, 9vw, 90px);
  font-weight:1000;
  text-align:center;
  padding:20px;
}
</style>
</head>

<body>

<header>
  <h1>Tafeloverzicht</h1>
</header>

<main>
  <div class="toolbar">
    <button id="resetAll" class="btn">Reset alles</button>
    <button id="helpBtn" class="btn help-btn">HELP</button>
    <button id="textBtn" class="btn text-btn">TEXT</button>
  </div>

  <div class="groups" id="groups"></div>
</main>

<!-- STATUS POPUP -->
<div id="statusOverlay" class="overlay">
  <div class="modal">
    <div class="modal-header">Kies status</div>
    <div class="modal-grid">
      <div class="choice" data-status="nieuw">Nieuw</div>
      <div class="choice" data-status="drank">Drank</div>
      <div class="choice" data-status="run">Run</div>
      <div class="choice" data-status="koffie">Koffie</div>
      <div class="choice" data-status="rekening">Rekening</div>
      <div class="choice reset" data-status="reset">Reset</div>
    </div>
  </div>
</div>

<!-- TEXT MENU -->
<div id="textOverlay" class="overlay">
  <div class="modal">
    <div class="modal-header">Kies bericht</div>
    <div class="modal-grid">
      <div class="choice" data-text="Boven uithalen">Boven uithalen</div>
      <div class="choice" data-text="IJs brengen">IJs brengen</div>
      <div class="choice" id="customText">Eigen invoer</div>
    </div>
  </div>
</div>

<!-- CUSTOM TEXT -->
<div id="customOverlay" class="overlay">
  <div class="modal">
    <div class="modal-header">Eigen bericht</div>
    <div class="modal-grid">
      <input id="customInput" placeholder="Typ berichtâ€¦" style="padding:10px;font-size:16px">
      <div class="choice" id="sendCustom">Versturen</div>
    </div>
  </div>
</div>

<!-- FULLSCREEN MESSAGE -->
<div id="alertScreen" class="alert-screen">
  <div id="alertText" class="alert-only"></div>
</div>

<!-- SUPABASE -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
const sb = supabase.createClient(
  "https://xiwdbvxnjcrdwjhmpjnf.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inhpd2RidnhuamNyZHdqaG1wam5mIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ2NjE1NzAsImV4cCI6MjA3MDIzNzU3MH0.d14QNY5Pof9j3zmlbs-5gBTs25s6xo_XYhyVbWE2P1k"
);

const GROUPS=[
  {label:"Beneden", zone:"bt", range:[1,13]},
  {label:"Boven", zone:"boven", range:[20,58]}
];

const groupsEl=document.getElementById("groups");
const statusOverlay=document.getElementById("statusOverlay");
const textOverlay=document.getElementById("textOverlay");
const customOverlay=document.getElementById("customOverlay");
const alertScreen=document.getElementById("alertScreen");
const alertText=document.getElementById("alertText");

let activeTable=null;

/* RENDER */
function render(){
  groupsEl.innerHTML="";
  GROUPS.forEach(g=>{
    const wrap=document.createElement("div");
    wrap.className="group";
    wrap.innerHTML=`<div class="group-label">${g.label}</div><div class="group-grid"></div>`;
    const grid=wrap.querySelector(".group-grid");
    grid.style.setProperty("--cols",Math.ceil(Math.sqrt(g.range[1]-g.range[0]+1)));
    for(let i=g.range[0];i<=g.range[1];i++){
      const t=document.createElement("div");
      t.className="table";
      t.innerHTML=`<div class="num">${i}</div><div class="note"></div><div class="timer"></div>`;
      t.onclick=()=>{activeTable=t;statusOverlay.classList.add("open")};
      grid.appendChild(t);
    }
    groupsEl.appendChild(wrap);
  });
}
render();

/* STATUS */
document.querySelectorAll(".choice[data-status]").forEach(c=>{
  c.onclick=()=>{
    if(!activeTable)return;
    const s=c.dataset.status;
    activeTable.className="table";
    activeTable.removeAttribute("data-status");
    if(s!=="reset"){
      activeTable.dataset.status=s;
      activeTable.classList.add("status-"+s);
      if(s==="nieuw")activeTable.querySelector(".num").classList.add("flagged");
    }
    statusOverlay.classList.remove("open");
  };
});

/* TEXT */
document.getElementById("textBtn").onclick=()=>textOverlay.classList.add("open");
textOverlay.querySelectorAll("[data-text]").forEach(b=>{
  b.onclick=()=>broadcast(b.dataset.text);
});
document.getElementById("customText").onclick=()=>{
  textOverlay.classList.remove("open");
  customOverlay.classList.add("open");
};
document.getElementById("sendCustom").onclick=()=>{
  broadcast(document.getElementById("customInput").value);
};

/* BROADCAST */
function broadcast(msg){
  if(!msg)return;
  alertText.textContent=msg;
  alertScreen.classList.add("show");
  setTimeout(()=>alertScreen.classList.remove("show"),6000);
  alertScreen.onclick=()=>alertScreen.classList.remove("show");
}
</script>
</body>
</html>
